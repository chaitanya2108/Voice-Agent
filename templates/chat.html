{% extends "base.html" %} {% block title %}Bella Vista Ristorante - Order
Assistant{% endblock %} {% block content %}
<div class="row">
  <div class="col-md-8 mx-auto">
    <div class="card chat-container">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">
          <i class="fas fa-utensils me-2"></i>Bella Vista Ristorante - Order
          Assistant
          <button
            class="btn btn-sm btn-outline-light float-end"
            onclick="clearChat()"
            title="Clear conversation"
          >
            <i class="fas fa-trash"></i>
          </button>
        </h4>
        <small class="text-light">Authentic Italian Cuisine Since 1985</small>
        <div id="clover-status" class="mt-2"></div>
      </div>
      <div class="card-body p-0">
        <!-- Chat Messages Area -->
        <div id="chat-messages" class="chat-messages">
          <div class="welcome-message text-center p-4">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Starting conversation...</p>
          </div>
        </div>

        <!-- Clover POS Status -->
        <div class="clover-status p-3 border-top bg-light">
          <div class="row align-items-center">
            <div class="col-md-6">
              <div id="clover-status" class="text-muted">
                <i class="fas fa-spinner fa-spin me-1"></i>Checking POS
                connection...
              </div>
            </div>
            <div class="col-md-6 text-end">
              <button
                id="disconnect-pos-btn"
                class="btn btn-sm btn-outline-danger"
                style="display: none"
                onclick="disconnectClover()"
              >
                <i class="fas fa-unlink me-1"></i>Disconnect POS
              </button>
            </div>
          </div>
        </div>

        <!-- Voice Settings -->
        <div class="voice-settings p-3 border-top bg-light">
          <div class="row align-items-center">
            <div class="col-md-6">
              <label for="voice-select" class="form-label mb-1">
                <i class="fas fa-microphone me-1"></i>AI Voice
              </label>
              <select id="voice-select" class="form-select form-select-sm">
                <option value="Kore" selected>Kore — Firm</option>
                <option value="Puck">Puck — Upbeat</option>
                <option value="Zephyr">Zephyr — Bright</option>
                <option value="Charon">Charon — Informative</option>
                <option value="Enceladus">Enceladus — Breathy</option>
                <option value="Leda">Leda — Youthful</option>
                <option value="Umbriel">Umbriel — Easy-going</option>
                <option value="Iapetus">Iapetus — Clear</option>
                <option value="Aoede">Aoede — Breezy</option>
                <option value="Callirrhoe">Callirrhoe — Easy-going</option>
                <option value="Autonoe">Autonoe — Bright</option>
                <option value="Orus">Orus — Firm</option>
                <option value="Fenrir">Fenrir — Excitable</option>
                <option value="Laomedeia">Laomedeia — Upbeat</option>
                <option value="Achird">Achird — Friendly</option>
                <option value="Zubenelgenubi">Zubenelgenubi — Casual</option>
                <option value="Vindemiatrix">Vindemiatrix — Gentle</option>
                <option value="Sulafat">Sulafat — Warm</option>
              </select>
            </div>
            <div class="col-md-6">
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="tts-enabled"
                  checked
                />
                <label class="form-check-label" for="tts-enabled">
                  <i class="fas fa-volume-up me-1"></i>Enable Voice Responses
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Chat Input Area -->
        <div class="chat-input p-3 border-top">
          <div class="input-group">
            <input
              type="text"
              id="message-input"
              class="form-control"
              placeholder="Type your message here..."
              maxlength="500"
              onkeypress="handleKeyPress(event)"
            />
            <button
              class="btn btn-primary"
              type="button"
              onclick="sendMessage()"
              id="send-button"
            >
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          <div class="mt-2">
            <button
              class="btn btn-sm btn-outline-secondary me-2"
              onclick="getRandomStarter()"
            >
              <i class="fas fa-dice"></i> Random Topic
            </button>
            <small class="text-muted">
              <span id="char-count">0</span>/500 characters
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Features Info -->
    <div class="row mt-5">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">
              <i class="fas fa-utensils text-primary"></i> Restaurant Features
            </h6>
            <ul class="list-unstyled mb-0">
              <li>
                <i class="fas fa-check text-success"></i> Menu browsing & search
              </li>
              <li>
                <i class="fas fa-check text-success"></i> Order taking &
                management
              </li>
              <li>
                <i class="fas fa-check text-success"></i> Allergen information
              </li>
              <li>
                <i class="fas fa-check text-success"></i> Restaurant hours &
                info
              </li>
              <li>
                <i class="fas fa-check text-success"></i> Voice responses with
                Gemini TTS
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">
              <i class="fas fa-lightbulb text-primary"></i> Quick Commands
            </h6>
            <ul class="list-unstyled mb-0">
              <li>
                <i class="fas fa-utensils text-warning"></i> "Show me the menu"
              </li>
              <li>
                <i class="fas fa-clock text-warning"></i> "What are your hours?"
              </li>
              <li>
                <i class="fas fa-shopping-cart text-warning"></i> "I'd like to
                order..."
              </li>
              <li>
                <i class="fas fa-search text-warning"></i> "Search for pasta"
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay" style="display: none">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">AI is thinking...</span>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
<script>
  // Check Clover connection status on page load
  async function checkCloverStatus() {
    try {
      const response = await fetch("/api/clover/status");
      const data = await response.json();

      const statusDiv = document.getElementById("clover-status");

      if (data.authenticated) {
        statusDiv.innerHTML = `
          <div class="alert alert-success alert-sm mb-0 py-1">
            <i class="fas fa-check-circle me-1"></i>
            <strong>Clover POS Connected</strong> - Merchant ID: ${data.merchant_id}
          </div>
        `;
      } else {
        statusDiv.innerHTML = `
          <div class="alert alert-warning alert-sm mb-0 py-1">
            <i class="fas fa-exclamation-triangle me-1"></i>
            <strong>Clover POS Not Connected</strong> -
            <a href="/oauth" class="alert-link text-white">Connect Now</a>
          </div>
        `;
      }
    } catch (error) {
      console.error("Error checking Clover status:", error);
      const statusDiv = document.getElementById("clover-status");
      statusDiv.innerHTML = `
        <div class="alert alert-danger alert-sm mb-0 py-1">
          <i class="fas fa-exclamation-circle me-1"></i>
          <strong>Error checking POS status</strong>
        </div>
      `;
    }
  }

  // Check status when page loads
  document.addEventListener("DOMContentLoaded", checkCloverStatus);
</script>
{% endblock %}
